---
layout: default
---

# 主键生成机制

## 集群中数据主键生成

由于数据进行了水平切分，使用基于单表的主键自增方式就会出现问题。例如：某个实体 A 被分了 10 张表，那么有可能会有 10 个相同记录的主键，此时实体 B 在依靠 A 的主键进行切分时就会出现问题。

为了避免上述情况的发生，每个表记录的主键生成都需要交给一个单独的服务来处理，Pinus 选择了使用基于 zookeeper 服务来生成主键，之所以选择 zookeeper 是出于以下几点考虑：

* 其主要作用就是为了协调分布式系统、包括分布式存储，因此为分布式系统提供了很多特性；
* 自身就是分布式的，容灾能力较强；
* 性能非常好，读写速度很快；
* 非常轻量，非常适合 Pinus 的使用场景。

其实网上也有很多其他的方式来生成主键。

## 生成主键的机制
在 zookeeper 中创建集群目录，集群目录中保存和表明相同的文件，每个文件的内容就是最后生成主键的数值。
