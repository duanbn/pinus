---
layout: default
---
# 集群中数据主键生成

由于数据进行了水平分割，因此使用基于单表的主键自增方式就会出现问题，例如某个实体A被分了10张表，那么有可能会有10个主键是相同的记录，此时实体B在依靠A的主键进行切分时就会出现问题。

为了避免上述的情况发生，每个表记录的主键生成都需要交给一个单独的服务来处理，pinus选择了使用基于zookeeper来生成主键的服务，之所以选择zookeeper是出于以下几点考虑

zookeeper主要作用就是为了协调分布式系统、包括分布式存储，因此为分布式系统提供了很多特性

zookeeper自身就是分布式的因为容灾能力比较强

zookeeper本身的性能非常好，读写速度很快

zookeeper非常轻量，非常适合pinus的使用场景

其实网上也有很多其他的方式来生成主键。

# 生成主键的机制
在zookeeper中创建集群目录，集群目录中保存和表明相同的文件，每个文件的内容就是最后生成主键的数值。
